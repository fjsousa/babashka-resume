{:paths ["src/clj"]
 :pods {org.babashka/fswatcher {:version "0.0.3"}}
 :deps {org.babashka/http-server {:mvn/version "0.1.11"}
        org.babashka/cli {:mvn/version "0.2.23"}}
 :tasks

 {:requires ([babashka.cli :as cli])
  :init (def cli-opts (cli/parse-opts *command-line-args* {:coerce {:port :int}}))
  :enter (println "Entering:" (:name (current-task)) " - " (:doc (current-task)) " With args: " *command-line-args* )

  nrepl
  {:requires ([babashka.fs :as fs]
              [babashka.nrepl.server :as srv])
   :task (do (srv/start-server! {:host "localhost"
                                 :port 1339})
             (spit ".nrepl-port" "1339")
             (-> (Runtime/getRuntime)
                 (.addShutdownHook
                  (Thread. (fn [] (fs/delete ".nrepl-port")))))
             (deref (promise)))}

  serve {:doc "Serve static assets"
         :requires ([babashka.http-server :as server])
         :task (server/exec (merge {:port 1337
                                    :dir "./html/"}
                                   cli-opts))}

  prn {:task (clojure "-X clojure.core/prn" cli-opts)}

  -dev {:depends [serve prn]}

  dev {:task (run '-dev {:parallel true})}

  beautify {:doc "pretty print html document. pass filepath as first arg."
            :task (shell "npx js-beautify --type html html/*.html -r -s 2 -d")}

  yaml-to-edn (do (shell "bb -m yaml-to-edn")
                  (run 'beautify))}}
